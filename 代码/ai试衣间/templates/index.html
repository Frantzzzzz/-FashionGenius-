<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè¯•è¡£é—´</title>
    <style>
        :root {
            --primary: #ff6b6b;
            --secondary: #ff9c4b;
            --accent: #ffbe76;
            --dark: #2d3436;
            --light: #f9f9f9;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }
        
        
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            background: linear-gradient(135deg, #f6f9fc, #e9f0f7);
            margin: 0;
            padding: 30px;
            color: var(--dark);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* ä¸»æ ‡é¢˜ */
        .page-title {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            color: var(--primary);
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .page-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: var(--secondary);
            margin: 8px auto;
            border-radius: 2px;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            max-width: 1600px; /* å¢åŠ æœ€å¤§å®½åº¦ */
            margin: 0 auto;
            gap: 30px; /* å¢åŠ é—´è· */
            justify-content: center; /* å†…å®¹å±…ä¸­ */
        }
        .panel {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 25px;
            flex: 1 1 45%; /* è°ƒæ•´flexåŸºç¡€å®½åº¦ */
            min-width: 350px; /* å¢åŠ æœ€å°å®½åº¦ */
            max-width: 650px; /* å¢åŠ æœ€å¤§å®½åº¦é™åˆ¶ */
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        /* é¢æ¿æ ‡é¢˜ */
        .panel h2 {
            margin-top: 0;
            color: var(--primary);
            border-bottom: 2px dashed #eee;
            padding-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .panel h2::before {
            content: 'ğŸ‘•';
            margin-right: 10px;
            font-size: 1.3rem;
        }
        
        .result-section h2::before {
            content: 'âœ¨';
        }
        
        /* æ¨¡ç‰¹å’Œç»“æœé¢„è§ˆ */
        .model-preview, .result-image {
            width: 100%;
            height: 450px;
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            background-color: #fafafa;
            transition: var(--transition);
        }
        
        .model-preview:hover, .result-image:hover {
            border-color: var(--secondary);
            background-color: #f5f9fa;
        }
        
        .model-preview span, .result-image span {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        .model-preview img, .result-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .category-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .category-tab {
            flex: 1;
            padding: 12px 15px;
            text-align: center;
            background-color: #f0f0f0;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            border-right: 1px solid #e0e0e0;
        }
        
        .category-tab:last-child {
            border-right: none;
        }
        
        .category-tab:hover {
            background-color: #e8e8e8;
        }
        
        .category-tab.active {
            background-color: var(--primary);
            color: white;
            font-weight: bold;
        }
        
        /* è¡£ç‰©ç½‘æ ¼ */
        .clothing-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* ä¸¤åˆ—å¸ƒå±€ */
            gap: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px 5px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) #f0f0f0;
        }
        
        .clothing-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .clothing-grid::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 10px;
        }
        
        .clothing-grid::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 10px;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* ä¸¤åˆ—å¸ƒå±€ */
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px 5px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) #f0f0f0;
        }
        
        .history-grid::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-grid::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 10px;
        }
        
        .history-grid::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 10px;
        }
        /* è¡£ç‰©é¡¹ç›® */
        
        .clothing-item {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: white;
            position: relative;
            overflow: hidden;
        }
        
        .clothing-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
            border-color: var(--secondary);
            z-index: 2;
        }
        
        .clothing-item.selected {
            border: 2px solid var(--primary);
            box-shadow: 0 0 0 3px rgba(255,107,107,0.3);
            transform: translateY(-3px);
        }
        
        .clothing-item img {
            width: 100%;
            height: 100px; /* é™ä½é«˜åº¦ç¡®ä¿å®Œæ•´æ˜¾ç¤º */
            object-fit: contain; /* ä¿®æ”¹ä¸ºcontainç¡®ä¿å›¾ç‰‡å®Œæ•´æ˜¾ç¤º */
            border-radius: 8px;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }
        
        .clothing-item:hover img {
            transform: scale(1.1);
        }
        
        .clothing-item p {
            margin: 5px 0 0;
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* å·²é€‰æ‹©æœè£…æ˜¾ç¤º */
        .garment-selection {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 12px;
            font-size: 0.95rem;
            border-left: 4px solid var(--secondary);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(78, 205, 196, 0.4); }
            70% { box-shadow: 0 0 0 5px rgba(78, 205, 196, 0); }
            100% { box-shadow: 0 0 0 0 rgba(78, 205, 196, 0); }
        }
        
        /* æŒ‰é’®æ ·å¼ */
        button {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), #ff8e8e);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        button:hover {
            background: linear-gradient(135deg, #ff5252, var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(255,107,107,0.4);
        }
        
        button:disabled {
            background: linear-gradient(135deg, #cccccc, #dddddd);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }
        
        /* çŠ¶æ€å’Œè¿›åº¦æ¡ */
        .status {
            margin-top: 20px;
            color: #666;
            text-align: center;
            font-size: 0.9rem;
            padding: 10px;
            border-radius: 8px;
            background-color: #f5f5f5;
            transition: var(--transition);
        }
        
        .progress-container {
            width: 100%;
            height: 12px;
            background-color: #f0f0f0;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            transition: width 0.5s ease;
            border-radius: 10px;
            box-shadow: 0 0 8px rgba(78,205,196,0.5);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            100% { left: 100%; }
        }
        
        /* å†å²è®°å½•éƒ¨åˆ† */
        h3 {
            margin-top: 30px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            font-size: 1.3rem;
        }
        
        h3::before {
            content: 'ğŸ“‹';
            margin-right: 8px;
        }
        /* ä¸»æ ‡é¢˜æ ·å¼ç¾åŒ– */
        h1.page-title {
            text-align: center;
            margin: 0 auto 30px;
            padding: 15px 0;
            position: relative;
            color: var(--primary);
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            background: linear-gradient(to right, #fff6f6, white, #f6f9fc);
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.2);
            max-width: 500px;
            font-weight: bold;
            letter-spacing: 2px;
            transition: var(--transition);
        }

        h1.page-title:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        h1.page-title:after {
            content: '';
            display: block;
            width: 100px;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            margin: 10px auto 0;
            border-radius: 3px;
        }

        /* å¢åŠ æ ‡é¢˜å‰çš„è£…é¥°å›¾æ ‡ */
        h1.page-title:before {
            content: 'ğŸ‘—';
            display: inline-block;
            margin-right: 15px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        /* æ·»åŠ è¡£ç‰©é€‰æ‹©æ—¶çš„åŠ¨ç”»æ•ˆæœ */
        .clothing-item.selected {
            border: 2px solid var(--primary);
            box-shadow: 0 0 0 3px rgba(255,107,107,0.3);
            transform: translateY(-3px);
            animation: selectPulse 1.5s infinite;
        }

        @keyframes selectPulse {
            0% { box-shadow: 0 0 0 0 rgba(255,107,107,0.6); }
            70% { box-shadow: 0 0 0 8px rgba(255,107,107,0); }
            100% { box-shadow: 0 0 0 0 rgba(255,107,107,0); }
        }

        /* æ·»åŠ é€‰é¡¹å¡åˆ‡æ¢åŠ¨ç”» */
        .category-tab {
            position: relative;
            overflow: hidden;
        }

        .category-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .category-tab:hover::after {
            width: 100%;
        }

        .category-tab.active::after {
            width: 100%;
        }

        /* æŒ‰é’®ç‚¹å‡»æ³¢çº¹æ•ˆæœ */
        #tryOnBtn {
            position: relative;
            overflow: hidden;
        }

        #tryOnBtn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%, -50%);
            transform-origin: 50% 50%;
        }

        #tryOnBtn:active::after {
            animation: ripple 0.6s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.5;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }

        .model-preview, .result-image {
            width: 100%;
            height: 400px; /* ç¨å¾®é™ä½é«˜åº¦ */
            border: 2px dashed #e0e0e0;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            background-color: #fafafa;
            transition: var(--transition);
        }

        .model-preview img[style*="display: block"], .result-image img[style*="display: block"] {
            opacity: 1;
        }

        /* ä¸ºæœè£…é€‰æ‹©æ·»åŠ åˆ‡æ¢åŠ¨ç”» */
        .garment-selection {
            transition: all 0.3s ease;
        }

        .garment-selection p span {
            position: relative;
            display: inline-block;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .garment-selection p span:not(:contains('æ— ')):hover {
            transform: translateY(-2px);
            color: var(--primary);
            cursor: pointer;
        }

        /* ä¸ºå†å²è®°å½•é¡¹æ·»åŠ ç¼©æ”¾åŠ¨ç”» */
        #historyGrid .clothing-item {
            transform-origin: center;
            transition: all 0.3s ease;
        }

        #historyGrid .clothing-item:hover {
            z-index: 5;
            transform: scale(1.1);
        }
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple-effect 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple-effect {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }
        /* å“åº”å¼è°ƒæ•´ */

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                gap: 20px;
            }
            
            .panel {
                min-width: 90%;
                max-width: 90%;
            }
            
            .upload-input-group {
                flex-direction: column;
            }
            
            .upload-btn {
                width: 100%;
            }
        }

        @media (min-width: 1200px) {
            .container {
                gap: 40px;
            }
            
            .panel {
                flex: 1 1 40%;
            }
        }
        /* æ¨¡ç‰¹é€‰æ‹©å™¨æ ·å¼ */
        .model-selector {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .model-selector label {
            font-weight: 500;
            color: var(--dark);
        }

        .model-selector select {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: var(--transition);
            cursor: pointer;
        }

        .model-selector select:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(255,107,107,0.1);
        }

        .model-selector select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255,107,107,0.2);
        }
        /* æ¨¡ç‰¹é€‰æ‹©å™¨æ ·å¼ */
        .model-selector {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .model-selector label {
            font-weight: 500;
            color: var(--dark);
            white-space: nowrap;
        }

        .model-selector select {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
        }

        /* ä¸Šä¼ æ¨¡å—æ ·å¼ */
        .upload-section {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px dashed #ddd;
        }

        .upload-section h3 {
            margin: 0 0 10px 0;
            font-size: 1rem;
            color: #666;
            display: flex;
            align-items: center;
        }

        .upload-section h3::before {
            content: "â¤´";
            margin-right: 8px;
            font-size: 1.2rem;
        }

        .upload-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .upload-input-group input {
            flex: 3; 
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .upload-btn {
            padding: 0 15px;
            flex: 1; /* æŒ‰é’®åªå æ®å¿…è¦ç©ºé—´ */
            min-width: 80px; /* è®¾ç½®æœ€å°å®½åº¦ */
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center; /* å†…å®¹å±…ä¸­ */
            gap: 5px;
            transition: var(--transition);
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }

        .upload-btn:hover {
            background: #ff8c3b;
        }

        .upload-icon {
            font-size: 1.1rem;
        }

        /* ä¸Šä¼ æç¤ºæ ·å¼ */
        .upload-tips {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .tips-header h4 {
            margin: 0;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .tips-content {
            padding: 10px 15px;
            margin: 0;
            font-size: 0.85rem;
            list-style: none;
            display: none; /* é»˜è®¤éšè— */
        }

        .tips-header {
            cursor: pointer;
            user-select: none;
        }

        .toggle-icon {
            transition: transform 0.3s;
            font-size: 0.8rem;
        }

        .tips-content li {
            padding: 10px 15px;
            margin: 0;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
        }

        .emoji {
            margin-right: 8px;
            font-size: 1rem;
        }

        /* ä¸Šä¼ æˆåŠŸåŠ¨ç”» */
        @keyframes uploadSuccess {
            0% { background-color: var(--secondary); }
            50% { background-color: #4CAF50; }
            100% { background-color: var(--secondary); }
        }

        .upload-success {
            animation: uploadSuccess 1s;
        }
        /* ä¸Šä¼ é”™è¯¯çŠ¶æ€ */
        .upload-error {
            background-color: #ff6b6b !important;
        }

        /* ä¸Šä¼ è¾“å…¥æ¡†éªŒè¯çŠ¶æ€ */
        input:invalid {
            border-color: #ff6b6b;
            box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.2);
        }
    </style>
</head>
<body>
    <h1 class="page-title">AIè¯•è¡£é—´</h1>
    
    <div class="container">
        <div class="panel model-section">
            <h2>æ¨¡ç‰¹</h2>
            <!-- æ–°å¢æ¨¡ç‰¹é€‰æ‹©ä¸‹æ‹‰èœå• -->
            <div class="model-selector">
                <label for="modelSelect">é€‰æ‹©æ¨¡ç‰¹:</label>
                <select id="modelSelect" onchange="changeModel()">
                    <option value="female">æˆå¹´å¥³æ€§</option>
                    <option value="male">æˆå¹´ç”·æ€§</option>
                    <option value="teen-female">é’å°‘å¹´(å¥³)</option>
                    <option value="teen-male">é’å°‘å¹´(ç”·)</option>
                    <option value="child-female">å°å¥³å­©</option>
                    <option value="child-male">å°ç”·å­©</option>
                    <option value="elder-female">è€å¥¶å¥¶</option>
                    <option value="elder-male">è€çˆ·çˆ·</option>
                </select>
            </div>
                <!-- æ–°å¢çš„è‡ªå®šä¹‰æ¨¡ç‰¹ä¸Šä¼ æ¨¡å— -->
                <div class="upload-section">
                    <h3>ä¸Šä¼ å›¾ç‰‡</h3>
                    <!-- <div class="upload-tabs">
                        <div class="upload-tab active" data-type="model">æ¨¡ç‰¹å›¾</div>
                        <div class="upload-tab" data-type="top">ä¸Šè£…</div>
                        <div class="upload-tab" data-type="bottom">ä¸‹è£…</div>
                        <div class="upload-tab" data-type="dress">è¿è¡£è£™</div>
                    </div> -->
                        <!-- æ¨¡ç‰¹ä¸Šä¼ å®¹å™¨ -->
                    <div class="upload-container active" id="modelUpload">
                        <div class="upload-input-group">
                            <input type="text" id="modelUrl" placeholder="è¾“å…¥æ¨¡ç‰¹å›¾ç‰‡HTTPé“¾æ¥">
                            <button onclick="uploadImage('model')" class="upload-btn">ä¸Šä¼ </button>
                        </div>
                        <!-- <div class="upload-tips">
                            <div class="tips-header" onclick="toggleTips(this)">
                                <h4>ä¸Šä¼ è¦æ±‚</h4>
                                <span class="toggle-icon">â–¼</span>
                            </div>
                            <ul class="tips-content">
                                <li><span class="emoji">ğŸ‘«</span> å…¨èº«æ­£é¢ç«™ç«‹å§¿åŠ¿</li>
                                <li><span class="emoji">âœ‹</span> æ‰‹è‡‚è‡ªç„¶ä¸‹å‚ä¸é®æŒ¡èº«ä½“</li>
                                <li><span class="emoji">ğŸŒ</span> å…‰çº¿å‡åŒ€ï¼Œæ— å¼ºçƒˆé˜´å½±</li>
                                <li><span class="emoji">âšª</span> å»ºè®®ä½¿ç”¨çº¯è‰²èƒŒæ™¯</li>
                                <li><span class="emoji">ğŸ“</span> åˆ†è¾¨ç‡å»ºè®®800x1200åƒç´ ä»¥ä¸Š</li>
                            </ul>
                        </div> -->
                    </div>
                        <!-- ä¸Šè£…ä¸Šä¼ å®¹å™¨ -->
                    <div class="upload-container" id="topUpload">
                        <div class="upload-input-group">
                            <input type="text" id="topUrl" placeholder="è¾“å…¥ä¸Šè£…å›¾ç‰‡HTTPé“¾æ¥">
                            <button onclick="uploadImage('top')" class="upload-btn">ä¸Šä¼ </button>
                        </div>
                        <!-- <div class="upload-tips">
                            <div class="tips-header" onclick="toggleTips(this)">
                                <h4>ä¸Šä¼ è¦æ±‚</h4>
                                <span class="toggle-icon">â–¼</span>
                            </div>
                            <ul class="tips-content">
                                <li><span class="emoji">ğŸ‘•</span> ç±»å‹ï¼šå•ä»¶ä¸Šè£…ï¼ˆTæ¤ã€è¡¬è¡«ã€æ¯›è¡£ç­‰ï¼‰</li>
                                <li><span class="emoji">ğŸ“¸</span> æ‹æ‘„ï¼šå¹³é“ºæ‹æ‘„ï¼Œæ— è¤¶çš±</li>
                                <li><span class="emoji">ğŸ¨</span> èƒŒæ™¯ï¼šç®€æ´ç»Ÿä¸€ï¼Œä¸»ä½“æ¸…æ™°</li>
                                <li><span class="emoji">ğŸš«</span> é™åˆ¶ï¼šä¸æ”¯æŒå†…è¡£ã€æ³³è£…ç­‰ç‰¹æ®Šæœè£…</li>
                                <li><span class="emoji">ğŸ–¼ï¸</span> æ„å›¾ï¼šæœè£…åº”å æ®å›¾ç‰‡70%ä»¥ä¸Šé¢ç§¯</li>
                            </ul>
                        </div> -->
                    </div>
                        <!-- ä¸‹è£…ä¸Šä¼ å®¹å™¨ -->
                    <div class="upload-container" id="bottomUpload">
                        <div class="upload-input-group">
                            <input type="text" id="bottomUrl" placeholder="è¾“å…¥ä¸‹è£…å›¾ç‰‡HTTPé“¾æ¥">
                            <button onclick="uploadImage('bottom')" class="upload-btn">ä¸Šä¼ </button>
                        </div>
                        <!-- <div class="upload-tips">
                            <div class="tips-header" onclick="toggleTips(this)">
                                <h4>ä¸Šä¼ è¦æ±‚</h4>
                                <span class="toggle-icon">â–¼</span>
                            </div>
                            <ul class="tips-content">
                                <li><span class="emoji">ğŸ‘–</span> ç±»å‹ï¼šå•ä»¶ä¸‹è£…ï¼ˆè£¤å­ã€è£™å­ç­‰ï¼‰</li>
                                <li><span class="emoji">ğŸ“¸</span> æ‹æ‘„ï¼šå¹³é“ºæ‹æ‘„ï¼Œå±•ç¤ºå®Œæ•´ç‰ˆå‹</li>
                                <li><span class="emoji">ğŸŒˆ</span> é¢œè‰²ï¼šçœŸå®è¿˜åŸï¼Œæ— ä¸¥é‡è‰²å·®</li>
                                <li><span class="emoji">ğŸ“</span> æ¯”ä¾‹ï¼šä¿æŒè‡ªç„¶æ¯”ä¾‹ï¼Œæ— æ‹‰ä¼¸å˜å½¢</li>
                                <li><span class="emoji">ğŸ§¼</span> æ•´æ´ï¼šæ— æ±¡æ¸ã€ç ´æŸç­‰æ˜æ˜¾ç‘•ç–µ</li>
                            </ul>
                        </div> -->
                    </div>
                        <!-- è¿è¡£è£™ä¸Šä¼ å®¹å™¨ -->
                    <div class="upload-container" id="dressUpload">
                        <div class="upload-input-group">
                            <input type="text" id="dressUrl" placeholder="è¾“å…¥è¿è¡£è£™å›¾ç‰‡HTTPé“¾æ¥">
                            <button onclick="uploadImage('dress')" class="upload-btn">ä¸Šä¼ </button>
                        </div>
                        <!-- <div class="upload-tips">
                            <div class="tips-header" onclick="toggleTips(this)">
                                <h4>ä¸Šä¼ è¦æ±‚</h4>
                                <span class="toggle-icon">â–¼</span>
                            </div>
                            <ul class="tips-content">
                                <li><span class="emoji">ğŸ‘—</span> ç±»å‹ï¼šå®Œæ•´è¿è¡£è£™ï¼ˆéä¸Šä¸‹è£…ç»„åˆï¼‰</li>
                                <li><span class="emoji">ğŸ”„</span> å±•ç¤ºï¼šå»ºè®®æ‚¬æŒ‚æˆ–å¹³é“ºå±•ç¤º</li>
                                <li><span class="emoji">ğŸ‘”</span> ç»†èŠ‚ï¼šé¢†å£ã€è¢–å£ç­‰ç»†èŠ‚æ¸…æ™°å¯è§</li>
                                <li><span class="emoji">ğŸš«</span> é™åˆ¶ï¼šä¸æ”¯æŒå©šçº±ã€ç¤¼æœç­‰å¤æ‚æ¬¾å¼</li>
                                <li><span class="emoji">ğŸ“</span> å¯¹ç§°ï¼šä¿æŒæœè£…å¯¹ç§°ï¼Œæ— æ‰­æ›²å˜å½¢</li>
                            </ul>
                        </div> -->
                    </div>
                    <div class="upload-notice">
                        <p>âš ï¸ æ³¨æ„ï¼šä»…æ”¯æŒHTTP/HTTPSå›¾ç‰‡é“¾æ¥ï¼Œä¸æ”¯æŒæœ¬åœ°æ–‡ä»¶ä¸Šä¼ </p>
                        <p>âœ… æ”¯æŒæ ¼å¼ï¼šJPGã€JPEGã€PNGã€BMPï¼ˆå»ºè®®å°ºå¯¸800x1200åƒç´ å·¦å³ï¼‰</p>
                    </div>
            </div>

            <div class="model-preview" id="modelPreview">
                <span>è¯·é€‰æ‹©æ¨¡ç‰¹å›¾ç‰‡</span>
                <img id="modelImage" style="display: none;">
            </div>
            
            <div class="category-tabs">
                <div class="category-tab active" data-category="tops">ä¸Šè£…</div>
                <div class="category-tab" data-category="bottoms">ä¸‹è£…</div>
                <div class="category-tab" data-category="dresses">è¿è¡£è£™</div>
            </div>
            
            <div id="tops" class="clothing-grid" style="display: block;">
                <!-- ä¸Šè£…ä¼šåœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
            
            <div id="bottoms" class="clothing-grid" style="display: none;">
                <!-- ä¸‹è£…ä¼šåœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
            
            <div id="dresses" class="clothing-grid" style="display: none;">
                <!-- è¿è¡£è£™ä¼šåœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
            
            <div class="garment-selection">
                <p>å·²é€‰æ‹©: <span id="selectedTop">æ— </span> + <span id="selectedBottom">æ— </span></p>
            </div>
            
            <button id="tryOnBtn" onclick="tryOnOutfit()">è¯•ç©¿</button>
            <div class="status" id="status"></div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
        
        <div class="panel result-section">
            <h2>è¯•ç©¿ç»“æœ</h2>
            <div class="result-image" id="resultImage">
                <span>è¯•ç©¿ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</span>
                <img id="resultImageDisplay" style="display: none;">
            </div>
            
            <div id="historySection">
                <h3>å†å²è®°å½•</h3>
                <div id="historyGrid" class="history-grid">
                    <!-- å†å²è®°å½•ä¼šåœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // æœè£…æ•°æ®
        const clothingData = {
            tops: [
                { name: "å¤–å¥—", url: "https://cdn.yoox.biz/49/49326400PC_14_F.jpg" },
                { name: "æ¯›è¡£", url: "https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1389646171/p801327.jpeg" },
                { name: "è¡¬è¡«", url: "https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1389646171/p801341.jpeg" },
                { name: "çŸ­è¢–", url: "https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/1389646171/p801339.jpeg" },
                { name: "è è", url: "https://humanaigc-outfitanyone.hf.space/file=/tmp/gradio/63efb4850bbba65a2880d7ed9d8faff3859a6ab3/garment1.png"}
            ],
            bottoms: [
                { name: "çŸ­è£™", url: "https://img01-gms.17zwd.com/imgextra/63091650/i2/84607bb6-7cdc-4f66-9085-1442738b5a61.jpeg" },
                { name: "çŸ­è£™", url: "https://img01-gms.17zwd.com/imgextra/373005/i2/bf499fd0-61ee-4f21-83ba-49484c27b1d3.jpeg" },
                { name: "çŸ­è£¤", url: "https://img01-gms.17zwd.com/imgextra/61222262/i2/7aaaa23a-fc6b-4ecb-96c3-7fd76d8d4ff6.jpeg" },
                { name: "é•¿è£¤", url: "https://img01-gms.17zwd.com/imgextra/62559777/i2/59d759e4-1798-4000-8b75-7d9405dd5c18.jpeg" }
            ],
            dresses: [
                { name: "è¿è¡£è£™", url: "https://pic.rmb.bdstatic.com/bjh/240418/51ee0eb02bcec764c42e491c04d42f812973.jpeg" }
            ]
        };

        // æ¨¡ç‰¹å›¾ç‰‡æ•°æ®
        const modelImages = {
            'female': "https://pic4.zhimg.com/v2-6b91035391dbb8dd6b989f1264ff439b_r.jpg",
            'male': "https://t4.ftcdn.net/jpg/06/26/95/63/360_F_626956301_XbKQ0erohdI9NnrDXmBrN4xW27zLdtyU.jpg",
            'teen-female': "https://www.shutterstock.com/shutterstock/photos/2309827033/display_1500/stock-photo-full-body-portrait-of-happy-asian-student-girl-with-uniform-isolated-on-white-background-2309827033.jpg",
            'teen-male': "https://thumbs.dreamstime.com/b/student-young-man-full-body-portrait-smiling-people-isolated-white-student-young-man-full-body-portrait-smiling-people-isolated-136872059.jpg",
            'child-female': "https://c8.alamy.com/comp/RDM2K9/child-kid-little-girl-full-body-portrait-isolated-on-a-white-background-RDM2K9.jpg",
            'child-male': "https://st3.depositphotos.com/1044737/19286/i/1600/depositphotos_192867006-stock-photo-child-kid-little-boy-blond.jpg",
            'elder-female': "https://thumbs.dreamstime.com/b/elderly-woman-walking-cane-smiling-full-length-portrait-isolated-white-background-86085346.jpg",
            'elder-male': "https://images.rawpixel.com/image_800/czNmcy1wcml2YXRlL3Jhd3BpeGVsX2ltYWdlcy93ZWJzaXRlX2NvbnRlbnQvbHIvc3R1ZGlvNzctbWNraW5zZXktMDYwNC1wYWlfMy5qcGc.jpg"
        };
        
        // å…¨å±€å˜é‡
        let currentModel = 'female';
        let modelImageUrl = modelImages[currentModel];
        let selectedTop = null;
        let selectedBottom = null;
        let selectedDress = null;
        let currentTaskId = null;
        let checkInterval = null;
        let tryonHistory = [];
        
        // åŠ è½½æ¨¡ç‰¹å›¾ç‰‡
        function loadModelImage() {
            const modelImg = document.getElementById('modelImage');
            modelImg.src = modelImageUrl;
            modelImg.style.display = 'block';
            modelImg.onload = function() {
                document.querySelector('#modelPreview span').style.display = 'none';
            };
            modelImg.onerror = function() {
                document.querySelector('#modelPreview span').style.display = 'block';
                document.querySelector('#modelPreview span').textContent = 'åŠ è½½æ¨¡ç‰¹å›¾ç‰‡å¤±è´¥';
            };
        }

        // åˆ‡æ¢æ¨¡ç‰¹
        function changeModel() {
            const modelSelect = document.getElementById('modelSelect');
            currentModel = modelSelect.value;
            modelImageUrl = modelImages[currentModel];
            loadModelImage();
            resetSelection();
            updateStatus(`å·²åˆ‡æ¢ä¸º${modelSelect.options[modelSelect.selectedIndex].text}`);
        }

        function loadClothingItems() {
            // åŠ è½½ä¸Šè£…
            const topsGrid = document.getElementById('tops');
            clothingData.tops.forEach((item, index) => {
                topsGrid.appendChild(createClothingItemElement(item, 'top', index));
            });
            
            // åŠ è½½ä¸‹è£…
            const bottomsGrid = document.getElementById('bottoms');
            clothingData.bottoms.forEach((item, index) => {
                bottomsGrid.appendChild(createClothingItemElement(item, 'bottom', index));
            });
            
            // åŠ è½½è¿è¡£è£™
            const dressesGrid = document.getElementById('dresses');
            clothingData.dresses.forEach((item, index) => {
                dressesGrid.appendChild(createClothingItemElement(item, 'dress', index));
            });
        }

        // ä¸Šä¼ å›¾ç‰‡
        async function uploadImage(type) {
            // è·å–å¯¹åº”ç±»å‹çš„URLè¾“å…¥æ¡†
            const urlInput = document.getElementById(`${type}Url`);
            const imageUrl = urlInput.value.trim();
            
            // åŸºæœ¬éªŒè¯
            if (!imageUrl) {
                updateStatus('è¯·è¾“å…¥å›¾ç‰‡URL');
                return;
            }
            
            // ç®€å•éªŒè¯URLæ ¼å¼
            if (!imageUrl.startsWith('http://') && !imageUrl.startsWith('https://')) {
                updateStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„HTTP/HTTPSé“¾æ¥');
                return;
            }
            
            try {
                updateStatus(`æ­£åœ¨éªŒè¯${getChineseTypeName(type)}å›¾ç‰‡URL...`);
                
                // åˆ›å»ºä¸´æ—¶å›¾ç‰‡éªŒè¯URLæœ‰æ•ˆæ€§
                const img = new Image();
                img.onload = function() {
                    // å›¾ç‰‡åŠ è½½æˆåŠŸåçš„å¤„ç†
                    switch(type) {
                        case 'model':
                            modelImageUrl = imageUrl;
                            loadModelImage();
                            break;
                        case 'top':
                            clothingData.tops.unshift({ 
                                name: "è‡ªå®šä¹‰ä¸Šè£…", 
                                url: imageUrl 
                            });
                            break;
                        case 'bottom':
                            clothingData.bottoms.unshift({ 
                                name: "è‡ªå®šä¹‰ä¸‹è£…", 
                                url: imageUrl 
                            });
                            break;
                        case 'dress':
                            clothingData.dresses.unshift({ 
                                name: "è‡ªå®šä¹‰è¿è¡£è£™", 
                                url: imageUrl 
                            });
                            break;
                    }
                    
                    // é‡æ–°åŠ è½½æœè£…åˆ—è¡¨
                    loadClothingItems();
                    updateStatus(`${getChineseTypeName(type)}å›¾ç‰‡æ·»åŠ æˆåŠŸ!`);
                    
                    // æ˜¾ç¤ºæˆåŠŸæ•ˆæœ
                    const btn = document.querySelector(`button[onclick="uploadImage('${type}')"]`);
                    btn.classList.add('upload-success');
                    setTimeout(() => btn.classList.remove('upload-success'), 1000);
                    
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    urlInput.value = '';
                };
                
                img.onerror = function() {
                    updateStatus('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URL');
                };
                
                img.src = imageUrl;
                
            } catch (error) {
                updateStatus(`å‘ç”Ÿé”™è¯¯: ${error.message}`);
                console.error('ä¸Šä¼ é”™è¯¯:', error);
            }
        }

        // è¾…åŠ©å‡½æ•°ï¼šè·å–ä¸­æ–‡ç±»å‹å
        function getChineseTypeName(type) {
            const names = {
                'model': 'æ¨¡ç‰¹',
                'top': 'ä¸Šè£…',
                'bottom': 'ä¸‹è£…',
                'dress': 'è¿è¡£è£™'
            };
            return names[type] || type;
        }

        function createClothingItemElement(item, type, index) {
            const container = document.createElement('div');
            container.className = 'clothing-item';
            container.dataset.type = type;
            container.dataset.index = index;
            
            const img = document.createElement('img');
            img.src = item.url;
            img.alt = item.name;
            
            const p = document.createElement('p');
            p.textContent = item.name;
            
            container.appendChild(img);
            container.appendChild(p);
            
            container.addEventListener('click', function() {
                selectClothingItem(this, type, index);
            });
            
            return container;
        }
        // åˆ‡æ¢æç¤ºæ˜¾ç¤º/éšè—
        function toggleTips() {
            const tipsContent = document.querySelector('.tips-content');
            const toggleIcon = document.querySelector('.toggle-icon');
            
            tipsContent.style.display = tipsContent.style.display === 'none' ? 'block' : 'none';
            toggleIcon.textContent = tipsContent.style.display === 'none' ? 'â–¼' : 'â–²';
        }
        function setupCategoryTabs() {
            const tabs = document.querySelectorAll('.category-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // æ›´æ–°æ´»åŠ¨æ ‡ç­¾
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ˜¾ç¤ºå¯¹åº”çš„æœè£…ç½‘æ ¼
                    const category = this.dataset.category;

                    document.querySelectorAll('#tops, #bottoms, #dresses').forEach(grid => {
                        grid.style.display = 'none';
                    });
                    document.getElementById(this.dataset.category).style.display = 'block';
                    
                    // å¦‚æœé€‰æ‹©äº†è¿è¡£è£™ç±»åˆ«ï¼Œé‡ç½®ä¸Šè¡£å’Œä¸‹è£…é€‰æ‹©
                    if (category === 'dresses') {
                        selectedTop = null;
                        selectedBottom = null;
                        document.getElementById('selectedTop').textContent = "æ— ";
                        document.getElementById('selectedBottom').textContent = "æ— ";
                    }
                    
                    // æ–°å¢
                    document.querySelectorAll('.upload-container').forEach(container => {
                        container.style.display = 'none';
                    });
                    const type = this.dataset.type;
                    document.getElementById(`${type}Upload`).style.display = 'block';

                });
            });
        }

        function selectClothingItem(element, type, index) {
            // é‡ç½®åŒç±»å‹çš„é€‰æ‹©
            document.querySelectorAll(`.clothing-item[data-type="${type}"]`).forEach(item => {
                item.classList.remove('selected');
            });
            
            // è®¾ç½®å½“å‰é€‰æ‹©
            element.classList.add('selected');
            
            // æ›´æ–°å…¨å±€å˜é‡
            if (type === 'top') {
                selectedTop = clothingData.tops[index];
                selectedDress = null;
                document.getElementById('selectedTop').textContent = selectedTop.name;
            } else if (type === 'bottom') {
                selectedBottom = clothingData.bottoms[index];
                selectedDress = null;
                document.getElementById('selectedBottom').textContent = selectedBottom.name;
            } else if (type === 'dress') {
                selectedDress = clothingData.dresses[index];
                selectedTop = null;
                selectedBottom = null;
                document.getElementById('selectedTop').textContent = selectedDress.name;
                document.getElementById('selectedBottom').textContent = "æ— ";
            }
        }

        function resetSelection() {
            // é‡ç½®é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.clothing-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // é‡ç½®å…¨å±€å˜é‡
            selectedTop = null;
            selectedBottom = null;
            selectedDress = null;
            document.getElementById('selectedTop').textContent = "æ— ";
            document.getElementById('selectedBottom').textContent = "æ— ";
        }

        async function tryOnOutfit() {
            // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„é€‰æ‹©
            if (!selectedTop && !selectedBottom && !selectedDress) {
                updateStatus('è¯·è‡³å°‘é€‰æ‹©ä¸€ä»¶æœè£…ï¼ˆä¸Šè£…ã€ä¸‹è£…æˆ–è¿è¡£è£™ï¼‰');
                return;
            }
            
            const tryOnBtn = document.getElementById('tryOnBtn');
            tryOnBtn.disabled = true;
            updateStatus('æ­£åœ¨å‡†å¤‡è¯•è¡£è¯·æ±‚...');
            document.getElementById('progressBar').style.width = '0%';
            
            try {
                // ç¡®å®šæœè£…URL
                let topUrl = selectedDress ? selectedDress.url : (selectedTop ? selectedTop.url : "");
                let bottomUrl = selectedDress ? "" : (selectedBottom ? selectedBottom.url : "");
                
                // è°ƒç”¨è¯•è¡£API
                updateStatus('æ­£åœ¨æäº¤è¯•è¡£è¯·æ±‚...');
                
                // é˜²æŠ–åŠ¨é€»è¾‘ï¼Œé¿å…å¤šæ¬¡æäº¤
                if (currentTaskId) {
                    clearInterval(checkInterval);
                    checkInterval = null;
                }

                const response = await fetch('/api/tryon', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model_image_url: modelImageUrl,
                        top_garment_url: topUrl,
                        bottom_garment_url: bottomUrl
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.task_id) {
                    currentTaskId = data.task_id;
                    updateStatus('è¯•è¡£ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†...');
                    document.getElementById('progressBar').style.width = '10%';
                    
                    // å¼€å§‹è½®è¯¢ä»»åŠ¡çŠ¶æ€
                    startPollingTaskStatus(currentTaskId);
                } else {
                    updateStatus('APIè°ƒç”¨å¤±è´¥: ' + JSON.stringify(data.error || "æœªçŸ¥é”™è¯¯"));
                    tryOnBtn.disabled = false;
                }
            } catch (error) {
                updateStatus('å‡ºé”™: ' + error.message);
                console.error(error);
                tryOnBtn.disabled = false;
            }
        }

        function startPollingTaskStatus(taskId) {
            if (checkInterval) clearInterval(checkInterval);
            
            let progress = 10;
            let attempts = 0;
            const maxAttempts = 60; // æœ€å¤šå°è¯•60æ¬¡ï¼Œå³2åˆ†é’Ÿ
            
            checkInterval = setInterval(async () => {
                try {
                    attempts++;
                    // æ¨¡æ‹Ÿè¿›åº¦ï¼Œæ¯æ¬¡å¢åŠ ä¸€ç‚¹
                    progress = Math.min(progress + 1, 90);
                    document.getElementById('progressBar').style.width = progress + '%';
                    
                    const response = await fetch(`/api/task/${taskId}`);
                    const data = await response.json();
                    
                    if (response.ok && data.image_url) {
                        // ä»»åŠ¡æˆåŠŸå®Œæˆ
                        clearInterval(checkInterval);
                        document.getElementById('progressBar').style.width = '100%';
                        updateStatus('è¯•è¡£å®Œæˆ!');
                        
                        // æ˜¾ç¤ºç»“æœ
                        console.log('Task completed:', data.image_url);
                        showResultImage(data.image_url);

                        // æ·»åŠ åˆ°å†å²è®°å½•
                        console.log('Adding to history:', data.image_url);
                        addToHistory(data.image_url);
                        console.log('History updated:', tryonHistory);
                        
                        document.getElementById('tryOnBtn').disabled = false;
                    } else if (data.error) {
                        // ä»»åŠ¡å¤±è´¥
                        clearInterval(checkInterval);
                        updateStatus('è¯•è¡£å¤„ç†å¤±è´¥: ' + JSON.stringify(data.error));
                        document.getElementById('tryOnBtn').disabled = false;
                    } else if (attempts >= maxAttempts) {
                        // è¶…æ—¶
                        clearInterval(checkInterval);
                        updateStatus('å¤„ç†è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•');
                        document.getElementById('tryOnBtn').disabled = false;
                    } else {
                        // ç»§ç»­ç­‰å¾…
                        updateStatus('è¯•è¡£å¤„ç†ä¸­... è¯·è€å¿ƒç­‰å¾…');
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥çŠ¶æ€å‡ºé”™:', error);
                    clearInterval(checkInterval);
                    updateStatus('æ£€æŸ¥çŠ¶æ€å‡ºé”™: ' + error.message);
                    document.getElementById('tryOnBtn').disabled = false;
                }
            }, 2000); // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡
        }

        function addToHistory(imageUrl) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„å›¾ç‰‡ï¼Œé¿å…é‡å¤æ·»åŠ 
            const exists = tryonHistory.some(item => item.imageUrl === imageUrl);
            if (!exists) {
                tryonHistory.unshift({
                    imageUrl: imageUrl
                });
                // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼ˆæœ€å¤š8å¼ ï¼‰
                if (tryonHistory.length > 8) {
                    tryonHistory = tryonHistory.slice(0, 8);
                }
                // ä¿å­˜åˆ° localStorage
                localStorage.setItem('tryonHistory', JSON.stringify(tryonHistory));
                updateHistoryDisplay();
            } else {
                console.log('Image already in history, not adding duplicate:', imageUrl);
            }
        }

        function updateHistoryDisplay() {
            const historyGrid = document.getElementById('historyGrid');
            if (!historyGrid) {
                console.error("historyGrid element not found");
                return;
            }
            
            historyGrid.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (tryonHistory.length === 0) {
                console.log("No history items to display");
                const noHistoryMsg = document.createElement('p');
                noHistoryMsg.style.gridColumn = '1/-1';
                noHistoryMsg.style.textAlign = 'center';
                noHistoryMsg.style.color = '#888';
                noHistoryMsg.textContent = 'æš‚æ— å†å²è®°å½•';
                historyGrid.appendChild(noHistoryMsg);
                return;
            }
            
            // éå†å†å²è®°å½•å¹¶åˆ›å»ºæ˜¾ç¤ºå…ƒç´ 
            tryonHistory.forEach((item, index) => {
                if (!item || !item.imageUrl) {
                console.error("Invalid history item at index", index, item);
                return;
                }
                
                const historyItem = document.createElement('div');
                historyItem.className = 'clothing-item';
                historyItem.style.cursor = 'pointer';
                
                // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
                const img = document.createElement('img');
                img.src = item.imageUrl;
                img.alt = `å†å²è®°å½• ${index + 1}`;
                img.style.width = '100%';
                img.style.height = '150px';
                img.style.objectFit = 'cover';
                img.style.borderRadius = '8px';
                
                // æ·»åŠ é”™è¯¯å¤„ç†
                img.onerror = function() {
                    console.error("Failed to load image:", item.imageUrl);
                    img.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Crect fill="%23f2f2f2" width="100" height="100"/%3E%3Ctext fill="%23999" font-family="sans-serif" font-size="14" dy=".3em" text-anchor="middle" x="50" y="50"%3EåŠ è½½å¤±è´¥%3C/text%3E%3C/svg%3E';
                };
                
                // ç‚¹å‡»å†å²è®°å½•å›¾ç‰‡æ—¶æ˜¾ç¤ºå¤§å›¾
                historyItem.addEventListener('click', function() {
                    console.log("æ˜¾ç¤ºç»“æœå›¾ç‰‡:", item.imageUrl);
                    showResultImage(item.imageUrl);
                });
                
                historyItem.appendChild(img);
                // æ·»åŠ æ—¶é—´æˆ³
                // if (item.timestamp) {
                //     const timestamp = document.createElement('small');
                //     timestamp.textContent = item.timestamp;
                //     timestamp.style.display = 'block';
                //     timestamp.style.fontSize = '10px';
                //     timestamp.style.color = '#888';
                //     timestamp.style.textAlign = 'center';
                //     timestamp.style.marginTop = '4px';
                //     historyItem.appendChild(timestamp);
                // }
                historyGrid.appendChild(historyItem);
                
                console.log("Added history item to grid:", index, item.imageUrl);
            });
            
            console.log("History display updated with", tryonHistory.length, "items");
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•ï¼ˆåœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ï¼‰
        function loadHistoryFromStorage() {
            try {
                const storedHistory = localStorage.getItem('tryonHistory');
                if (storedHistory) {
                    tryonHistory = JSON.parse(storedHistory);
                    console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½äº†å†å²è®°å½•ï¼Œæ•°é‡:', tryonHistory.length);
                    updateHistoryDisplay();
                }
            } catch (e) {
                console.warn('æ— æ³•ä»æœ¬åœ°å­˜å‚¨åŠ è½½å†å²è®°å½•:', e);
            }
        }

        function showResultImage(imageUrl) {
            const resultImg = document.getElementById('resultImageDisplay');
            if (!resultImg) {
                console.error("resultImageDisplay element not found");
                return;
            }
            
            resultImg.src = imageUrl;
            resultImg.style.display = 'block';
            
            // æ·»åŠ é”™è¯¯å¤„ç†
            resultImg.onerror = function() {
                console.error("Failed to load result image:", imageUrl);
                document.querySelector('#resultImage span').style.display = 'block';
                document.querySelector('#resultImage span').textContent = 'å›¾ç‰‡åŠ è½½å¤±è´¥';
                resultImg.style.display = 'none';
            };
            
            resultImg.onload = function() {
                console.log("Result image loaded successfully");
                const messageSpan = document.querySelector('#resultImage span');
                if (messageSpan) {
                messageSpan.style.display = 'none';
                }
            };
            
            console.log("Result image set to:", imageUrl);
            }

        function updateStatus(message) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.style.display = 'block';
            
            // 2ç§’åè‡ªåŠ¨éšè—çŠ¶æ€ä¿¡æ¯
            setTimeout(function() {
                statusElement.style.opacity = '0';
                statusElement.style.transition = 'opacity 0.5s ease';
                
                setTimeout(function() {
                statusElement.style.display = 'none';
                statusElement.style.opacity = '1';
                }, 500);
            }, 2000);
        }
        
        function addAnimationEffects() {
        // ä¸ºå·²é€‰æ‹©æœè£…æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const garmentSelections = document.querySelectorAll('.garment-selection p span');
            garmentSelections.forEach(span => {
                span.addEventListener('click', function() {
                    if(this.textContent !== 'æ— ') {
                        this.style.color = 'var(--primary)';
                        this.animate([
                            { transform: 'scale(1)' },
                            { transform: 'scale(1.2)' },
                            { transform: 'scale(1)' }
                        ], {
                            duration: 500,
                        });
                    }
                });
            });
            
            // ä¸ºè¯•ç©¿æŒ‰é’®æ·»åŠ ç‚¹å‡»ç‰¹æ•ˆ
            const tryOnBtn = document.getElementById('tryOnBtn');
            tryOnBtn.addEventListener('click', function(e) {
                // åˆ›å»ºæ³¢çº¹æ•ˆæœ
                if(!this.disabled) {
                    const circle = document.createElement('span');
                    const diameter = Math.max(this.clientWidth, this.clientHeight);
                    const radius = diameter / 2;
                    
                    circle.style.width = circle.style.height = `${diameter}px`;
                    circle.style.left = `${e.clientX - this.offsetLeft - radius}px`;
                    circle.style.top = `${e.clientY - this.offsetTop - radius}px`;
                    circle.classList.add('ripple');
                    
                    const ripple = this.getElementsByClassName('ripple')[0];
                    if (ripple) {
                        ripple.remove();
                    }
                    
                    this.appendChild(circle);
                }
            });
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆåè°ƒç”¨
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½æ¨¡ç‰¹å›¾ç‰‡
            loadModelImage();
            
            // åŠ è½½æœè£…
            loadClothingItems();

            // åŠ è½½å†å²è®°å½•
            loadHistoryFromStorage()
            updateHistoryDisplay();
            
            // è®¾ç½®æ ‡ç­¾åˆ‡æ¢
            setupCategoryTabs();
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            addAnimationEffects();
        });
    </script>
</body>
</html>